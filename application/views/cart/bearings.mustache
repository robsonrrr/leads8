<div id="cartContent" class="modern-cart">

    <!-- Bearings Policy Alert -->
    <div class="modern-alert alert-warning mb-4">
        <div class="alert-content">
            <i class="bi bi-exclamation-triangle alert-icon"></i>
            <div class="alert-text">
                <strong>Pedido de Rolamentos!</strong> desconto, prazos de acordo com a política de Rolamentos. 
                Segmento: {{segmentoPOID}}, Desconto máximo de <strong>{{Total.maxdesconto}}%</strong> em relação aos produtos no carrinho.
            </div>
        </div>
    </div>

    <!-- Cart Header -->
    <div class="cart-header">
        <div class="row align-items-center">
            <div class="col-lg-3 col-md-4">
                <div class="cart-title">
                    <i class="bi bi-cart me-2"></i>
                    <span class="cart-count">{{Total.variedade}} Produto(s) no Carrinho</span>
                </div>
            </div>
            <div class="col-lg-2 col-md-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="stockCheck" data-update="{{CONTAINER}}lead/session/{{id}}" {{#SESSION.check}}checked{{/SESSION.check}}>
                    <label class="form-check-label" for="stockCheck">Verificar Estoque</label>
                </div>
            </div>

            <div class="col-lg-7 col-md-5">
                <div class="cart-actions">
                    <!-- Client Actions -->
                    <div class="action-group">
                        <a class="btn btn-outline-primary btn-sm" target="_blank" href="/clientes_editar.php?DADOS={{Cliente.id}}">
                            <i class="bi bi-person-gear me-1"></i> Editar Cliente
                        </a>
                        <a class="btn btn-outline-primary btn-sm" target="_blank" href="/mak.php?TIPO=PAGAMENTOS&DADOS={{Cliente.id}}&MNOME={{Cliente.clienteNome}}">
                            <i class="bi bi-credit-card me-1"></i> Pagamentos
                        </a>
                        <a class="btn btn-outline-primary btn-sm" target="_blank" href="/orders/orders_per_client.php?client={{Cliente.id}}">
                            <i class="bi bi-clipboard-check me-1"></i> Pedidos
                        </a>
                    </div>
                    
                    <!-- Ticket Actions -->
                    <div class="action-group">
                        <a class="btn btn-outline-secondary btn-sm" href="#" data-toggle="modal"
                           data-target="#modalTicketAdd" data-remote="{{CONTAINER}}ticket/new/{{Cliente.clienteID}}/{{Lead.id}}"
                           data-name="{{Cliente.clienteNome}}" data-customer="{{Cliente.clienteID}}" data-title="Criar um Novo Ticket">
                            <i class="bi bi-ticket me-1"></i> Criar Ticket
                        </a>
                        <a class="btn btn-outline-secondary btn-sm" data-toggle="modal" data-title="Ver Tickets" 
                           data-target="#remoteModal" data-remote="/agendor/tickets/?cliente={{Cliente.clienteID}}">
                            <i class="bi bi-eye me-1"></i> Ver Tickets
                        </a>
                    </div>
                    
                    <!-- Lead Actions -->
                    <div class="action-group">
                        <a class="btn btn-outline-warning btn-sm" target="_blank" href="{{CONTAINER}}lead/delete/{{id}}/{{segmentoPOID}}">
                            <i class="bi bi-trash me-1"></i> Deletar Lead
                        </a>
                        <a class="btn btn-outline-warning btn-sm click-ajax-response" href="#" data-url="{{CONTAINER}}lead/recalculate/{{id}}/{{segmentoPOID}}">
                            <i class="bi bi-arrow-clockwise me-1"></i> Recalcular
                        </a>
                        <a class="btn btn-outline-warning btn-sm click-ajax-response" href="#" data-url="{{CONTAINER}}lead/recalculate/{{id}}/{{segmentoPOID}}?price=true">
                            <i class="bi bi-arrow-clockwise me-1"></i> Atualizar Preço
                        </a>
                        
                        {{#existProducts}}
                        <a class="btn btn-outline-warning btn-sm disabled" onclick="return false;" href="#">
                            <i class="bi bi-lightning me-1"></i> Raio-Y
                        </a>                
                        {{/existProducts}}
                        {{^existProducts}}
                        <a class="btn btn-outline-warning btn-sm click-ajax-response" href="#" data-url="{{CONTAINER}}lead/raioy/{{id}}/{{segmentoPOID}}">
                            <i class="bi bi-lightning me-1"></i> Raio-Y
                        </a>
                        {{/existProducts}}
                    </div>
                    
                    <!-- Export Actions -->
                    <div class="action-group">
                        <a target="_blank" class="btn btn-outline-info btn-sm" href="{{CONTAINER}}lead/mail/{{id}}/{{segmentoPOID}}">
                            <i class="bi bi-envelope-open me-1"></i> Email
                        </a>
                        <a target="_blank" class="btn btn-outline-info btn-sm" href="{{CONTAINER}}lead/print/{{id}}/{{segmentoPOID}}">
                            <i class="bi bi-printer me-1"></i> Imprimir
                        </a>
                        <button type="button" class="btn btn-outline-info btn-sm" data-toggle="modal" data-target="#exampleModal" data-lead="{{id}}"
                                {{#existPendencies}}disabled{{/existPendencies}} {{#existProducts}}disabled{{/existProducts}}>
                            <i class="bi bi-file-earmark-arrow-up me-1"></i> Importar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        {{#existPendencies}}
        <div class="col-12">
            <div class="modern-alert alert-danger">
                <div class="alert-content">
                    <i class="bi bi-exclamation-circle alert-icon"></i>
                    <div class="alert-text">
                        <strong>Pendências!</strong> favor corrigir {{existPendencies}}
                    </div>
                </div>
            </div>
        </div>
        {{/existPendencies}}
    </div>

    <!-- Hide Empty Discounts Button -->
    <div class="row mb-3">
        <div class="col-12 text-center">
            <button type="button" class="btn btn-outline-danger btn-sm hide-all-empty-discounts" title="Hide all rows with empty or zero discount values">
                <i class="bi bi-eye-slash"></i> Hide Empty Discounts
            </button>
        </div>
    </div>

    <!-- Modern Cart Table -->
    <div class="modern-table-container">
        <table class="modern-table cart-table" id="cartTable">
            <thead class="table-header">
                <tr class="header-row">
                    <th class="col-number">
                        <i class="bi bi-hash"></i>
                    </th>
                    <th class="col-image">
                        <i class="bi bi-image"></i>
                    </th>
                    <th class="col-product">
                        <i class="bi bi-box me-1"></i>Produto
                    </th>
                    <th class="col-brand">
                        <i class="bi bi-tag me-1"></i>Marca
                    </th>
                    <th class="col-package">
                        <i class="bi bi-box me-1"></i>Emb.
                    </th>
                    <th class="col-weight">
                        <i class="bi bi-speedometer me-1"></i>Peso
                    </th>
                    <th class="col-quantity">
                        <i class="bi bi-sort-numeric-up me-1"></i>Qtd.
                    </th>
                    <th class="col-price">
                        <i class="bi bi-currency-dollar me-1"></i>Valor Venda
                    </th>
                    <th class="col-subtotal">
                        <i class="bi bi-calculator me-1"></i>Produto
                    </th>
                    <th class="col-ipi">
                        <i class="bi bi-percent me-1"></i>IPI
                    </th>
                    <th class="col-st">
                        <i class="bi bi-percent me-1"></i>ST
                    </th>
                    <th class="col-total">
                        <i class="bi bi-cash me-1"></i>Total
                    </th>
                    <th class="col-discount">
                        <i class="bi bi-percent me-1"></i>Desconto
                    </th>
                    {{#SESSION.acessoDiretoria}}  
                    <th class="col-margin">
                        <i class="bi bi-graph-up me-1"></i>Margem
                    </th>
                    {{/SESSION.acessoDiretoria}}
                    <th class="col-actions">
                        <i class="bi bi-gear"></i>
                    </th>
                </tr>
        </thead>
        <tbody class="table-body"> 
            {{#Produtos}}
            <tr id="colunm_{{POID}}" class="product-row {{#produtoIndisponivel}}row-unavailable{{/produtoIndisponivel}}">
                <th class="cell-number" scope="row">
                    <div class="number-content">
                        <span class="product-count">{{produtoContagem}}</span>
                        <div class="checkbox-wrapper">
                            <input class="checkBoxClass" name="product" type="checkbox" id="product_{{POID}}" value="{{POID}}">
                        </div>
                    </div>
                </th>
                <td class="cell-image">
                    <div class="image-wrapper">
                        <a href="#" class="product-image-link" data-toggle="modal" data-title="Produto Informações" data-target="#remoteModal"
                           data-remote="{{CONTAINER}}lead/product/{{produtoPOID}}">
                            <img src="{{ENV.img}}id/w45/{{produtoPOID}}.jpg?version={{VERSION}}" class="product-thumbnail" alt="{{Detalhe.produtoModelo}}">
                        </a>
                    </div>
                </td>
                <td class="cell-product">
                    <div class="product-info">
                        <div class="product-model">
                            <strong><a class="color-primary" href="{{CONTAINER}}{{id}}/{{segmentoPOID}}?query={{Detalhe.produtoModelo}}">{{Detalhe.produtoModelo}}</a></strong>
                            {{> partials/product-actions}}
                            <small class="product-id">ID:{{produtoPOID}}</small>
                        </div>
                        <div class="product-name">
                            {{Detalhe.produtoNome}} <span class="product-dimensions">{{#solr.produtoMedida}} d:{{solr.produtoMedidaFuro}} x D:{{solr.produtoMedidaDiametro}} x B:{{solr.produtoMedidaLargura}} {{/solr.produtoMedida}}</span>
                        </div>
                    </div>
                </td>
                <td class="cell-brand">
                    <div class="brand-wrapper">
                        {{#Detalhe.produtoMarcaFormatado}}
                        <img width="50" src="{{ENV.cdn}}svg/marca/{{Detalhe.produtoMarcaFormatado}}.svg?version={{VERSION}}" title="{{Detalhe.produtoMarca}}" alt="{{Detalhe.produtoMarca}}" class="brand-logo"/>
                        {{/Detalhe.produtoMarcaFormatado}}
                        {{^Detalhe.produtoMarcaFormatado}}
                        <span class="no-brand">s/m</span>
                        {{/Detalhe.produtoMarcaFormatado}}
                    </div>
                </td>
                <td class="cell-package">
                    <div class="package-wrapper">
                        {{#Detalhe.produtoEmbalagem}}
                        <img width="35" src="{{ENV.cdn}}svg/icones/emb-{{Detalhe.produtoEmbalagem}}-{{Detalhe.produtoMarcaFormatado}}.svg?version={{VERSION}}" title="{{solr.produtoEmbalagem}}" alt="{{solr.produtoEmbalagem}}" class="package-icon"/>
                        {{/Detalhe.produtoEmbalagem}}
                        {{^Detalhe.produtoEmbalagem}}
                        <span class="package-text">{{solr.produtoEmbalagem}}</span>
                        {{/Detalhe.produtoEmbalagem}}
                    </div>
                </td>
                <td class="cell-weight">
                    <div class="weight-info">
                        <span class="weight-value">{{Detalhe.produtoPeso}}</span>
                        {{#SESSION.acessoFinanceiro}}
                        <div class="freight-info">Frete: {{produtoFrete}} / {{produtoFreteTotal}}</div>
                        {{/SESSION.acessoFinanceiro}}
                    </div>
                </td>
                <td class="cell-quantity">
                    <div class="quantity-wrapper">
                        <div class="quantity-input">
                            <input type="text" class="form-control quantity-field" data-update="/services/cart/update/{{POID}}" data-lead="{{id}}" autocomplete="off"
                                   data-product="{{produtoPOID}}" id="qty_cart_{{produtoPOID}}" value="{{produtoQuantidade}}" name="produtoQuantidade"
                                   min="1" max="999999" maxlength="5">
                        </div>
                        {{#SESSION.check}}
                        <div class="stock-info">
                            <div class="stock-item">
                                <a href="#" data-toggle="modal" data-title="Estoque Ecommerce" data-target="#remoteModal"
                                   data-remote="{{CONTAINER}}product/ecommerce/{{produtoPOID}}/{{Lead.unidadeEmitentePOID}}" title="Estoque Ecommerce: Carrinho Ativos">
                                    <i class="bi bi-cart me-1"></i>
                                    <span class="stock-label">Ecommerce:</span>
                                    <span class="stock-value">{{stock.estoqueEcommerce}}</span>
                                </a>
                            </div>
                            <div class="stock-item">
                                <i class="bi bi-shop me-1"></i>
                                <span class="stock-label">Comercial:</span>
                                <span class="stock-value" title="Estoque Comercial da {{Emitente.emitenteFantasia}}">{{stock.estoqueComercial}}</span>
                            </div>
                            <div class="stock-item">
                                <i class="bi bi-boxes me-1"></i>
                                <span class="stock-label">Total:</span>
                                <span class="stock-value color-primary" title="Estoque Total da Unidade {{Emitente.emitenteFantasia}}">{{stock.estoqueTotal}}</span>
                            </div>
                            <div class="stock-item">
                                <i class="bi bi-building me-1"></i>
                                <span class="stock-label">Geral:</span>
                                <span class="stock-value text-danger" title="Estoque Geral de Todas Unidades">{{stock.estoqueGeral}}</span>
                            </div>
                        </div>
                        {{/SESSION.check}}
                        {{^SESSION.check}}
                        <div class="stock-unavailable">
                            <small class="text-warning">-</small>
                        </div>
                        {{/SESSION.check}}
                    </div>
                </td>
                {{#produtoIndisponivel}}
                <td class="cell-unavailable" colspan="7">
                    <div class="modern-alert alert-danger">
                        <div class="alert-content">
                            <i class="bi bi-exclamation-triangle alert-icon"></i>
                            <div class="alert-text">
                                <strong>Produto Indisponível!</strong> Quantidade do item indisponível
                            </div>
                        </div>
                    </div>
                </td>
                {{/produtoIndisponivel}}
                {{^produtoIndisponivel}}
                <td class="cell-price">
                    <div class="price-input-wrapper">
                        {{#produtoPrecoAjustado}}
                        <input type="text" class="form-control price-input price-adjusted product-discount" id="qty_cart_discount_{{produtoPOID}}" data-type="price" min="0" max="" maxlength="" 
                               data-segment="{{segmentoPOID}}" data-product="{{produtoPOID}}" data-lead-product="{{POID}}" data-lead="{{id}}" data-url="{{CONTAINER}}lead/discount" value="{{produtoValorArredondado}}">
                        {{/produtoPrecoAjustado}}
                        {{^produtoPrecoAjustado}}
                        <input type="text" class="form-control price-input product-discount" id="qty_cart_discount_{{produtoPOID}}" data-type="price" min="0" max="" maxlength=""
                               data-segment="{{segmentoPOID}}" data-product="{{produtoPOID}}" data-lead-product="{{POID}}" data-lead="{{id}}" data-url="{{CONTAINER}}lead/discount" value="{{produtoValorArredondado}}">
                        {{/produtoPrecoAjustado}}
                        <div class="price-references">
                            <span class="price-client" title="Preço do Cliente">{{produtoValorOriginal}}</span>
                            <span class="price-separator">/</span>
                            <span class="price-base" title="Preço base do Produto">{{Detalhe.produtoRevenda}}</span>
                        </div>
                    </div>
                </td>
                <td class="cell-subtotal">
                    <div class="subtotal-info">
                        <div class="subtotal-value">{{produtoValorSubtotal}}</div>
                        {{#SESSION.acessoWebmaster}}
                        <div class="unit-info">
                            <i class="bi bi-info-circle me-1"></i>
                            <span class="unit-value">({{produtoValor}} unit.)</span>
                        </div>
                        {{/SESSION.acessoWebmaster}}
                    </div>
                </td>
                <td class="cell-ipi">
                    <div class="ipi-info">
                        <div class="ipi-value">{{produtoIPISubtotal}}</div>
                        {{#SESSION.acessoWebmaster}}
                        <div class="unit-info">
                            <i class="bi bi-percent me-1"></i>
                            <span class="unit-value">({{produtoIPI}} unit.)</span>
                        </div>
                        {{/SESSION.acessoWebmaster}}
                    </div>
                </td>
                <td class="cell-st">
                    <div class="st-info">
                        <div class="st-value">{{produtoSTSubtotal}}</div>
                        {{#SESSION.acessoWebmaster}}
                        <div class="unit-info">
                            <i class="fas fa-percent me-1"></i>
                            <span class="unit-value">({{produtoST}} unit.)</span>
                        </div>
                        {{/SESSION.acessoWebmaster}}
                    </div>
                </td>
                <td class="cell-total">
                    <div class="total-info">
                        <div class="total-value">{{produtoValorSubtotalComImpostos}}</div>
                        <div class="unit-info">
                            <i class="bi bi-calculator me-1"></i>
                            <span class="unit-value">({{produtoValorUnitarioComImpostos}} unit.)</span>
                        </div>
                    </div>
                </td>
                <td class="cell-discount">
                    <div class="discount-wrapper">
                        <input type="text" class="form-control discount-input mask-discount product-discount"
                               id="cart_discount_{{produtoPOID}}" data-type="discount" min="0" max="99" maxlength="3" data-product="{{produtoPOID}}"
                               data-classe="{{Detalhe.produtoClassificacao}}" data-lead-product="{{POID}}" data-segment="{{segmentoPOID}}" data-lead="{{id}}" 
                               data-url="{{CONTAINER}}lead/discount" value="{{produtoDescontoPorcentagem}}">
                        <div class="discount-max">
                            <i class="bi bi-percent me-1"></i>
                            <span class="max-label">Max:</span>
                            <span class="max-value">{{Classificacao.classificacaoDescontoVendedor}}%{{#SESSION.acessoGerencial}} / {{Classificacao.classificacaoDescontoGerente}}%{{/SESSION.acessoGerencial}}</span>
                        </div>
                    </div>
                </td>
                {{#SESSION.acessoDiretoria}}
                <td class="cell-margin">
                    <div class="margin-info">
                        <div class="margin-value">{{margemNominalFormatado}} / <span class="margin-percentage">{{margemPercentual}}%</span></div>
                        <div class="cost-info" title="Quantidade:{{Custo.qtd}}">{{Custo.estimado}} - {{Custo.chegada}}</div>
                    </div>
                </td>
                {{/SESSION.acessoDiretoria}}  
                {{/produtoIndisponivel}}
                <td class="cell-actions">
                    <div class="action-buttons">
                        <a class="cart-remove-item btn btn-sm btn-outline-danger remove-btn" href="#colunm_{{POID}}" data-lead-id="{{leadPOID}}" id="colunm_remove_{{POID}}" data-name="{{Detalhe.produtoModelo}}" data-product-id="{{POID}}" data-service="/services/cart/delete/{{POID}}" title="Remover produto">
                            <i class="bi bi-trash" aria-hidden="true"></i>
                        </a>
                    </div>
                </td>
            </tr>
            {{/Produtos}}
            {{^Produtos}}
            <tr class="empty-cart-row">
                <td colspan="16" class="empty-cart-cell">
                    <div class="modern-alert alert-info">
                        <div class="alert-content">
                            <i class="bi bi-cart alert-icon"></i>
                            <div class="alert-text">
                                <strong>Carrinho Vazio!</strong> Adicione produtos ao carrinho.
                            </div>
                        </div>
                    </div>
                </td>
            </tr>
            {{/Produtos}}
        </tbody>
        {{#Total}}
        <tfoot class="table-footer {{^Produtos}}d-none{{/Produtos}}">
            <tr class="totals-row">
                <td class="totals-spacer"></td>
                <td class="totals-spacer"></td>
                <td class="totals-spacer"></td>
                <td class="totals-spacer"></td>
                <td class="totals-spacer"></td>
                <td class="total-weight">
                    <i class="bi bi-speedometer me-1"></i>{{peso}}
                </td>
                <td class="total-quantity">
                    <i class="bi bi-sort-numeric-up me-1"></i>{{quantidade}}
                </td>
                <td class="totals-spacer"></td>
                <td class="total-product">{{produto}}</td>
                <td class="total-ipi">{{ipi}}</td>
                <td class="total-st">{{st}}</td>
                <td class="total-gross">{{bruto}}</td>
                <td class="total-discount">
                    <div class="discount-total">
                        <a href="#" class="jeditable-discount" data-url="{{CONTAINER}}lead/discountall/{{id}}/{{segmentoPOID}}">{{mdpedido}}</a>
                        <i class="bi bi-pencil ms-1"></i>
                    </div>
                </td>
                {{#SESSION.acessoDiretoria}}
                <td class="total-margin">
                    {{nominal}} / {{percentual}}%
                </td>
                {{/SESSION.acessoDiretoria}}
                <td class="totals-spacer"></td>
            </tr>
        </tfoot>
        {{/Total}}
    </table>
</div>

<!-- Product Actions -->
<div class="cart-bottom-actions">
    <div class="selected-actions">
        <h6 class="actions-title">
            <i class="bi bi-list-task me-2"></i>Ações para Produtos Selecionados
        </h6>
        <div class="action-group">
            <button id="" name="remove" class="btn btn-outline-danger btn-sm me-1 submitProducts">
                <i class="bi bi-trash me-1"></i>Remover Selecionados
            </button>
            <button id="" name="add" class="btn btn-outline-warning btn-sm me-1 submitProducts">
                <i class="bi bi-bookmark me-1"></i>Manter Selecionados
            </button>
            <button id="" name="notify" class="btn btn-outline-info btn-sm me-1 submitProducts">
                <i class="bi bi-bell me-1"></i>Notificar Selecionados
            </button>
            <button id="" name="lost" class="btn btn-outline-secondary btn-sm submitProducts">
                <i class="bi bi-floppy me-1"></i>Salvar como Perdidos
            </button>
        </div>
    </div>
    
    <div class="global-actions">
        <button type="button" class="btn btn-danger btn-sm cart-remove" href="#cart_remove" {{^existProducts}}disabled{{/existProducts}} data-lead-id="{{id}}" id="cart_remove" data-service="/services/cart/clear/{{id}}">
            <i class="bi bi-trash me-1"></i>Remover Todos os Produtos
        </button>
    </div>
    
    {{#existProducts}}
    <div class="checkout-actions">
        <a href="{{CONTAINER}}order/checkout/{{id}}/{{segmentoPOID}}" 
           class="btn btn-primary btn-lg checkout-btn {{^SESSION.check}}disabled{{/SESSION.check}} {{#existPendencies}}disabled{{/existPendencies}} {{#multiple}}disabled{{/multiple}}">
            <i class="bi bi-fast-forward me-2"></i>Ir para Próxima Etapa
        </a>
        <div class="checkout-info">
            <small class="checkout-text">{{#SESSION.check}}Clique para finalizar o pedido{{/SESSION.check}}{{^SESSION.check}}Faça login para continuar{{/SESSION.check}}</small>
        </div>
    </div>
    {{/existProducts}}
 </div>
</div>